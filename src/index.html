<html>
	<head>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	</head>
<body>
	<style>
		select{
			height: 30px;
		}
		button{			
			width: 120px !Important;
		}
		li{
			padding: 1px 10px 1px 10px !important;
		}

		.border-bottom{
			height: 45px !Important;
		}
		.border{
			height: 90% !Important;
		}
		.box{
			height: 350px;
		}
		.btr{
			width: 30px !important;
			margin-left: 15px !important;
    		padding-left: 10px !important;
			float: right !important;
			padding: 0px 10px 0px 0px;
		}
		.todoList{
			overflow: auto;
    		height: 100px;
		}
		.imgDiagram{
			width: 100%;
			height: 86%;
		}
		.mbdiagram{
			height:  90vh;
			max-width: 90vw;
		}
	</style>
	
	<div class="container">

		<div class="row p-2 badge-info">
			<div class="col-md-12 text-center">
				<h3>Kaffa - Pre-qualification test (v1.5)</h3>
			</div>
		</div>

		<div class="row">
		
			<div class="col-sm-12 col-md-6 box">
				<div class="row badge-light m-1 mt-3 border">
					<div class="col-md-12 text-left border-bottom p-2">
						<h5><span class="badge badge-dark">1</span> Validate CNPJ format (Mask)</h5>
					</div>
					<div class="col-md-12 text-left pt-2">	
						<p>
							<input onclick="cnpjMask()" name="ckCnpj" type="radio" id="cnpjFormatted" checked/>Formatted 
							<input onclick="cnpjMask()" name="ckCnpj" type="radio" id="cnpjNumber" />Number only
						</p>					
						<p>							
							<input oninput="cnpjMask()" onkeydown="cnpjMask()" id="cnpj" type="text" maxlength="18"/>
						</p>
						
						<p>
							<button onclick="validaCNPJ()" class="btn btn-default">Validate</button>
						</p>
					</div>
				</div>
			</div>

			<div class="col-sm-12 col-md-6 box">
				<div class="row badge-light m-1 mt-3 border">
					<div class="col-md-12 text-left border-bottom p-2">
						<h5><span class="badge badge-dark">2</span> Validate CNPJ digits</h5>
					</div>
					<div class="col-md-12 text-left pt-2">							
						<p>
							<button onclick="validaDigitsCNPJ()" class="btn btn-default">Validate</button>
						</p>
					</div>
				</div>
			</div>

		<div class="col-sm-12 col-md-6 box">
			<div class="row badge-light m-1 mt-3 border">
				<div class="col-md-12 text-left border-bottom p-2">
					<h5><span class="badge badge-dark">3</span> Test if two rectangles intersect</h5>
				</div>
				<div class="col-md-12 text-left pt-2">
					<h6>Rectangle dimension</h6>
					<p>
						<select id="rectangleName">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
						</select>
						<input id="dimension" placeholder="Example 3,5;11,11" type="text"/>
						<input id="rectInfo" placeholder="Example A,B" type="text"/>
					</p>
					<p>
						<ul id="rectangleList" class="list-group">
						</ul>
					</p>	
					<p>
						<button onclick="addRectangle(false)" class="btn btn-default">Add</button>						
						<button onclick="intersects(false)" class="btn btn-primary">Intersect</button>
					</p>
				</div>
			</div>
		</div>

		<div class="col-sm-12 col-md-6 box">
			<div class="row badge-light m-1 mt-3 border">
				<div class="col-md-12 text-left border-bottom p-2">
					<h5><span class="badge badge-dark">4</span> Compute area of intersection between two rectangles</h5>
				</div>
				<div class="col-md-12 text-left pt-2">
					<h6>Rectangle dimension</h6>
					<p>
						<select id="area_rectangleName">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
						</select>
						<input id="area_dimension" placeholder="Example 3,5;11,11" type="text"/>
						<input id="area_rectInfo" placeholder="Example A,B" type="text"/>
					</p>
					<p>
						<ul id="area_rectangleList" class="list-group">
						</ul>
					</p>	
					<p>
						<button onclick="addRectangle(true)" class="btn btn-default">Add</button>						
						<button onclick="intersects(true)" class="btn btn-primary">Area</button>
					</p>
				</div>
			</div>
		</div>

		<div class="col-sm-12 col-md-6 box">
			<div class="row badge-light m-1 mt-3 border">
				<div class="col-md-12 text-left border-bottom p-2">
					<h5><span class="badge badge-dark">5</span> Simple Todo List</h5>
				</div>
				<div class="col-md-12 text-left pt-2">
					<h6>Todo</h6>
					<p>						
						<input id="todoDate" type="date"/>
						<select id="todoTask">
							<option selected value="Task">Task</option>
							<option value="Alarm">Alarm</option>
							<option value="Family">Family</option>
							<option value="Meeting">Meeting</option>
							<option value="Plan">Plan</option>
							<option value="Shopping">Shopping</option>
							<option value="Work">Work</option>
						</select>
						<input id="todoText" placeholder="My exame" type="text"/>
					</p>
					<div class="todoList">
						<ul id="todoList" class="list-group">
						</ul>
					</div>	
					<p>
						<br>
						<button onclick="todolistadd()" class="btn btn-default">Add</button>						
						<button onclick="todolist()" class="btn btn-success">Load</button>
					</p>
				</div>
			</div>
		</div>

		<div class="col-sm-12 col-md-6 box">
			<div class="row badge-light m-1 mt-3 border">
				<div class="col-md-12 text-left border-bottom p-2">
					<h5><span class="badge badge-dark">6</span> Rest Client - World Clock</h5>
				</div>
				<div class="col-md-12 text-left pt-2">					
					<p>
						<ul id="restClient" class="list-group">
						</ul>
					</p>	
					<p>
						<button onclick="restClient()" class="btn btn-default">Queries</button>
					</p>
				</div>
			</div>
		</div>

		<div class="col-sm-12 col-md-6 box">
			<div class="row badge-light m-1 mt-3 border">
				<div class="col-md-12 text-left border-bottom p-2">
					<h5><span class="badge badge-dark">7</span> Rest Server - World Clock</h5>
				</div>
				<div class="col-md-12 text-left pt-2">					
					<p>
						<ul id="restServer" class="list-group">
						</ul>
					</p>	
					<p>
						<button onclick="restServer()" class="btn btn-default">Queries</button>
					</p>
				</div>
			</div>
		</div>

		<div class="col-sm-12 col-md-6 box" >
			<div class="row badge-light m-1 mt-3 border">
				<div class="col-md-12 text-left border-bottom p-2">
					<h5><span class="badge badge-dark">8</span> Entity Relationship Diagram - Simple Order Manager</h5>
				</div>
				<div class="col-md-12 text-left pt-2">					
					<p>
						<img onclick="$('#modalDiagram').modal('show')" class="imgDiagram" src="/data/diagram.png">
					</p>						
				</div>
			</div>
		</div>



		<div class="col-md-12 badge-dark mt-5 ml-3 mr-3">
			<p><br></p>
		</div>
		</div>
	</div>
	
	
	<div class="modal fade" id="modalDiagram" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered mbdiagram" role="document">
		  <div class="modal-content">
			<div class="modal-header">
			  <h5 class="modal-title" id="exampleModalLongTitle">Entity Relationship Diagram</h5>
			  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			  </button>
			</div>
			<div class="modal-body mbdiagram">
				<img class="imgDiagram" src="/data/diagram.png">
			</div>			
		  </div>
		</div>
	  </div>

	
	<script>

	function addRectangle(area){
		let idaux = "#";
		let dimension;
		if (area) {
			idaux = "#area_";
			dimension = $(idaux+"dimension").val().trim();
		}
		else{
			dimension = $(idaux+"dimension").val().trim();
		};

		dimension = dimension.replace(";,","").replace(",;","").replace(",;,","");

		let rect = dimension.split(";");
		let test = dimension.split(",");

		if ( rect.length != 2 || rect[0] == "" || rect[rect.length-1] == ""){
			alert("Dimensão inválida!");
			return;
		}
		if ( test.length != 3 || test[0] == "" || test[test.length-1] == ""){
			alert("Dimensão inválida!");
			return;
		}

		let recID = idaux.replace("#","")+"rectAdd_"+$(idaux+"rectangleName").val();
		if ( $("#"+recID).html() != "" ){
			$("#"+recID).remove();
		}		
		let list = $(idaux+"rectangleList").html();

		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {				
				$(idaux+"rectangleList").html(list+
					"<li id='"+recID+"' class='list-group-item'>"+
					$(idaux+"rectangleName").val()+" = "+
					"("+dimension+")"+
					"</li>");

				$(idaux+"dimension").val("");
			}
		};
		xhttp.open("GET", "/api/addrectangle?"+$(idaux+"rectangleName").val()+"="+dimension+"&area="+area, true);
		xhttp.send();
	}
	function intersects(area){
		let dimension;
		area ? dimension = $("#area_rectInfo").val().trim() : dimension = $("#rectInfo").val().trim();;

		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				alert(this.responseText);
			}
		};
		xhttp.open("GET", "/api/intersects?i="+dimension+"&area="+area, true);
		xhttp.send();
	}


	function todolist(){
		let list = $("#todoList").html();

		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {				
				let arrayList = [];
				let htmlList = "";
				if ( this.responseText.trim() != ""){
					arrayList = this.responseText.trim().split(",");
				}
				
				if ( arrayList.length < 1 ){
					htmlList = "Nenhuma tarefa";
				}
				else{
					for(i=1; i<arrayList.length; i++){
						let id = arrayList[i].split(";")[0];
						let dia = arrayList[i].split(";")[1];
						dia = new Date(dia.split('-')[0],Number(dia.split('-')[1])-1,dia.split('-')[2]);
						
						htmlList +=	"<li id='"+id+"' class='list-group-item'>"+
									dia.toLocaleDateString('en', {weekday:'short'})+", "+
									dia.getDate()+"/"+Number(dia.getMonth()+1)+"/"+dia.getFullYear()+" | "+
									arrayList[i].split(";")[2]+" | "+
									arrayList[i].split(";")[3]+

									"<button onclick='todolistremove("+id+")' class='btn btn-danger btr'>X</button>"+

									"</li>";
					}
				}
				$("#todoList").html(htmlList);
			}
		};
		xhttp.open("GET", "/api/todolist", true);
		xhttp.send();
	}
	function todolistadd(){
		let todoDate = $("#todoDate").val().trim();
		let todoText = $("#todoText").val().trim().replace(";","");
		let todoTask = $("#todoTask").val();

		if ( todoText == "" || todoDate == ""){
			alert("Favor informar os dados!");
			return;
		}

		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				todolist();
			}
		};
		xhttp.open("PUT", "/api/todolistadd?todo="+todoDate+";"+todoTask+";"+todoText, true);
		xhttp.send();
	}

	function todolistremove(id){
		if ( !confirm("Confirma remover esta tarefa?") ) return;

		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				todolist();
			}
		};
		xhttp.open("DELETE", "/api/todolistremove?id="+id, true);
		xhttp.send();
	}
	
	function restClient(){
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				let currentDateTime = this.response.currentDateTime;
				let dayOfTheWeek = this.response.dayOfTheWeek;
				$("#restClient").html("<li class='list-group'>"+currentDateTime+" - "+
									dayOfTheWeek+"</li>");
			}
		};
		xhttp.responseType = 'json';
		xhttp.open("GET", "http://worldclockapi.com/api/json/utc/now", true);
		xhttp.send();
	}

	function restServer(){
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				//let currentDateTime = this.response.currentDateTime;
				console.log(this.response);
				$("#restServer").html("<li class='list-group'>"+JSON.stringify(this.response)+"</li>");
			}
		};
		xhttp.responseType = 'json';
		xhttp.open("GET", "/api/restServer", true);
		xhttp.send();
	}
	
	function cnpjMask(){
		let cnpj = $("#cnpj").val();

		if ($("#cnpjFormatted").prop("checked")){
			$("#cnpj").attr("maxlength","18");

			cnpj=cnpj.replace(/\D/g,"");
			cnpj=cnpj.replace(/^(\d{2})(\d)/,"$1.$2");
			cnpj=cnpj.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3");
			cnpj=cnpj.replace(/\.(\d{3})(\d)/,".$1/$2");
			cnpj=cnpj.replace(/(\d{4})(\d)/,"$1-$2");
		}
		else{
			$("#cnpj").attr("maxlength","14");

			cnpj = cnpj.match(/\d+/g);
			cnpj = cnpj.join('');
		}
		

		$("#cnpj").val(cnpj);
	}
	function validaCNPJ(msg){
		let cnpj = $("#cnpj").val().trim();

		if ($("#cnpjFormatted").prop("checked")){
			if (cnpj.length < 18){
				if (msg == null){ 
					alert("CNPJ inválido!"); 
					return false;
				};
			}
			else{
				if (msg == null){
					alert("CNPJ OK!")
				}
				else{
					return true;
				}
			}
		}
		else{
			if (cnpj.length < 14){
				if (msg == null){
					alert("CNPJ inválido!");
					return false;
				}
			}
			else{
				if (msg == null){
					alert("CNPJ OK!")
				}
				else{
					return true;
				}
			}			
		}		
	}
	
	function validaDigitsCNPJ(){
		if ( validaCNPJ(1) == false ){
			alert("Dígito do CNPJ inválido!");
			return;
		}

		let cnpj = $("#cnpj").val().trim();
		cnpj = cnpj.match(/\d+/g);
		cnpj = cnpj.join('');

		let algarismos = String(cnpj).substr(0,12);
		let digitoInformado = String(cnpj).substr(12,2);
		let peso = "6543298765432";
		let digito1 = 0;
		let digito2 = 0;
		let resto = 0;

		// Cálculo do dígito 1
		for (i=0;i<12;i++){
			digito1 += Number(algarismos[i]) * Number(peso[i+1]);
		}
		resto = 11 - (digito1 % 11);
		resto < 2 ? digito1 = 0 : digito1 = resto;

		// Cálculo do dígito 2
		algarismos += digito1;
		for (i=0;i<13;i++){
			digito2 += Number(algarismos[i]) * Number(peso[i]);
		}
		resto = 11 - (digito2 % 11);
		resto < 2 ? digito2 = 0 : digito2 = resto;

;		// Verifica se o dígito cálculado é igual ao informado
		if (digitoInformado == String(digito1)+String(digito2)){
			alert("Dígito verificador OK!");
		}
		else{
			alert("Dígito do CNPJ inválido!");
		}
	}

	setTimeout(()=>{
		todolist();
	}, 300);

	</script>


	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>		

</body>
</html>